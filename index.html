<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Login | Student Payment Portal</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <style>
    * {margin: 0; padding: 0; box-sizing: border-box; font-family: 'Poppins', sans-serif;}
    body {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh; display: flex; align-items: center; justify-content: center;
      padding: 20px; position: relative; overflow: hidden;
    }
    .bg-bubbles {position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 1;}
    .bg-bubbles li {
      position: absolute; list-style: none; display: block; width: 40px; height: 40px;
      background-color: rgba(255,255,255,0.15); bottom: -160px; animation: square 25s infinite;
      transition-timing-function: linear; border-radius: 50%;
    }
    .bg-bubbles li:nth-child(1){left:10%;} .bg-bubbles li:nth-child(2){left:20%;width:80px;height:80px;animation-delay:2s;animation-duration:17s;}
    .bg-bubbles li:nth-child(3){left:25%;animation-delay:4s;} .bg-bubbles li:nth-child(4){left:40%;width:60px;height:60px;animation-duration:22s;}
    .bg-bubbles li:nth-child(5){left:70%;}
    @keyframes square{0%{transform:translateY(0) rotate(0);opacity:1;}100%{transform:translateY(-1000px) rotate(720deg);opacity:0;}}
    .container{position:relative;z-index:2;width:100%;max-width:400px;}
    .form-container{background:rgba(255,255,255,0.95);backdrop-filter:blur(10px);border-radius:20px;box-shadow:0 15px 35px rgba(0,0,0,0.2);}
    .header{background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);color:white;padding:40px 30px 30px;text-align:center;}
    .logo{font-size:3rem;margin-bottom:10px;display:block;}
    .header h1{font-size:1.8rem;font-weight:600;margin-bottom:5px;}
    .tabs{display:flex;background:#f8f9fa;border-bottom:2px solid #e9ecef;}
    .tab{flex:1;text-align:center;padding:20px;cursor:pointer;font-weight:500;color:#6c757d;transition:all 0.3s ease;position:relative;}
    .tab.active{color:#495057;background:white;}
    .form-content{padding:30px;}
    .form-page{display:none;} .form-page.active{display:block;}
    .form-group{margin-bottom:25px;}
    .input-with-icon{position:relative;}
    .input-with-icon i{position:absolute;left:15px;top:50%;transform:translateY(-50%);color:#6c757d;}
    .input-with-icon input{width:100%;padding:15px 15px 15px 45px;border:2px solid #e9ecef;border-radius:10px;font-size:14px;}
    .btn{width:100%;padding:15px;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);color:white;border:none;border-radius:10px;font-size:16px;font-weight:600;cursor:pointer;}
    .message{padding:12px;border-radius:8px;margin-bottom:20px;text-align:center;font-size:0.9rem;}
    .success{background:#d4edda;color:#155724;border:1px solid #c3e6cb;}
    .error{background:#f8d7da;color:#721c24;border:1px solid #f5c6cb;}
    .loading{display:inline-block;width:20px;height:20px;border:3px solid rgba(255,255,255,.3);border-radius:50%;border-top-color:#fff;animation:spin 1s linear infinite;}
    @keyframes spin{to{transform:rotate(360deg);}}
  </style>
</head>
<body>
  <ul class="bg-bubbles"><li></li><li></li><li></li><li></li><li></li></ul>
  <div class="container">
    <div class="form-container">
      <div class="header">
        <i class="fas fa-wallet logo"></i>
        <h1>Student Payment Portal</h1>
        <p>Secure access to your payment dashboard</p>
      </div>
      <div class="tabs">
        <div class="tab active" onclick="showTab('login')"><i class="fas fa-sign-in-alt"></i> Login</div>
        <div class="tab" onclick="showTab('register')"><i class="fas fa-user-plus"></i> Register</div>
      </div>
      <div class="form-content">
        <div class="form-page active" id="loginPage">
          <form id="loginForm">
            <div class="form-group">
              <label>Email Address</label>
              <div class="input-with-icon"><i class="fas fa-envelope"></i><input type="email" name="email" required></div>
            </div>
            <div class="form-group">
              <label>Password</label>
              <div class="input-with-icon"><i class="fas fa-lock"></i><input type="password" name="password" required></div>
            </div>
            <button type="submit" class="btn" id="loginBtn"><span>Sign In to Dashboard</span></button>
          </form>
          <div id="loginMessage"></div>
        </div>
        <div class="form-page" id="registerPage">
          <form id="registerForm">
            <div class="form-group">
              <label>Full Name</label>
              <div class="input-with-icon"><i class="fas fa-user"></i><input type="text" name="fullName" required></div>
            </div>
            <div class="form-group">
              <label>Email Address</label>
              <div class="input-with-icon"><i class="fas fa-envelope"></i><input type="email" name="email" required></div>
            </div>
            <div class="form-group">
              <label>Password</label>
              <div class="input-with-icon"><i class="fas fa-lock"></i><input type="password" name="password" required></div>
            </div>
            <div class="form-group">
              <label>Member ID</label>
              <div class="input-with-icon"><i class="fas fa-id-card"></i><input type="text" name="memberId" required></div>
            </div>
            <div class="form-group">
              <label>Phone Number</label>
              <div class="input-with-icon"><i class="fas fa-phone"></i><input type="tel" name="phone" required></div>
            </div>
            <button type="submit" class="btn" id="registerBtn"><span>Create Account</span></button>
          </form>
          <div id="registerMessage"></div>
        </div>
      </div>
    </div>
  </div>

  <script>
    const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbxZqHw4DYfsEzgfeuxlBTCeJsuhHqFUiq9yTnQmtua09uqXlHtrgt-_HJi2z5QNfW63/exec';

    function showTab(tabName) {
      document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
      document.querySelectorAll('.form-page').forEach(p=>p.classList.remove('active'));
      if(tabName==='login'){document.querySelector('.tab:nth-child(1)').classList.add('active');document.getElementById('loginPage').classList.add('active');}
      else{document.querySelector('.tab:nth-child(2)').classList.add('active');document.getElementById('registerPage').classList.add('active');}
    }

    document.getElementById('loginForm').addEventListener('submit', async (e)=>{
      e.preventDefault();
      const formData=new FormData(e.target);
      const msg=document.getElementById('loginMessage');
      const btn=document.getElementById('loginBtn');
      btn.innerHTML='<div class="loading"></div> Signing in...';btn.disabled=true;
      try{
        const res=await fetch(SCRIPT_URL,{method:'POST',body:new URLSearchParams({action:'login',email:formData.get('email'),password:formData.get('password')})});
        const result=await res.json();
        if(result.result==='success'){
          localStorage.setItem('currentUser',JSON.stringify(result.user));
          msg.innerHTML='<div class="success">Login successful! Redirecting...</div>';
          setTimeout(()=>window.location.href='dashboard.html',1000);
        }else msg.innerHTML='<div class="error">'+result.message+'</div>';
      }catch{msg.innerHTML='<div class="error">Network error. Please try again.</div>';}
      finally{btn.innerHTML='<span>Sign In to Dashboard</span>';btn.disabled=false;}
    });

    document.getElementById('registerForm').addEventListener('submit',async(e)=>{
      e.preventDefault();
      const formData=new FormData(e.target);
      const msg=document.getElementById('registerMessage');
      const btn=document.getElementById('registerBtn');
      btn.innerHTML='<div class="loading"></div> Creating account...';btn.disabled=true;
      try{
        const res=await fetch(SCRIPT_URL,{method:'POST',body:new URLSearchParams({
          action:'register',email:formData.get('email'),password:formData.get('password'),
          memberId:formData.get('memberId'),fullName:formData.get('fullName'),phone:formData.get('phone')})});
        const result=await res.json();
        if(result.result==='success'){msg.innerHTML='<div class="success">Registration successful! Please login.</div>';showTab('login');e.target.reset();}
        else msg.innerHTML='<div class="error">'+result.message+'</div>';
      }catch{msg.innerHTML='<div class="error">Network error. Please try again.</div>';}
      finally{btn.innerHTML='<span>Create Account</span>';btn.disabled=false;}
    });

    window.addEventListener('load',()=>{const currentUser=localStorage.getItem('currentUser');if(currentUser){window.location.href='dashboard.html';}});
  </script>
</body>
</html>
