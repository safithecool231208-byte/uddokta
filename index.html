<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Login | Student Payment Portal</title>

  <!-- Fonts & icons -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

  <style>
    :root{
      --bg1:#667eea;
      --bg2:#764ba2;
      --glass-bg: rgba(255,255,255,0.95);
      --muted:#6c757d;
      --max-width:520px;
      --radius:16px;
    }

    *{box-sizing:border-box;font-family:'Poppins',system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial; -webkit-font-smoothing:antialiased;}
    html,body{height:100%;margin:0;}
    body{
      background: linear-gradient(135deg,var(--bg1) 0%,var(--bg2) 100%);
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:20px;
      color:#243047;
    }

    .wrap{
      width:100%;
      max-width:var(--max-width);
      margin:0 auto;
      position:relative;
      z-index:2;
    }

    /* decorative bubbles (hidden on small devices to save CPU) */
    .bg-bubbles{position:absolute;inset:0;pointer-events:none;z-index:1;overflow:hidden}
    .bg-bubbles li{position:absolute;list-style:none;display:block;border-radius:50%;background:rgba(255,255,255,0.12);opacity:0.9;animation:float 20s linear infinite;}
    .bg-bubbles li:nth-child(1){width:60px;height:60px;left:6%;bottom:-80px;animation-duration:22s;}
    .bg-bubbles li:nth-child(2){width:90px;height:90px;left:22%;bottom:-100px;animation-duration:18s;animation-delay:2s;}
    .bg-bubbles li:nth-child(3){width:40px;height:40px;left:46%;bottom:-70px;animation-duration:26s;animation-delay:4s;}
    .bg-bubbles li:nth-child(4){width:70px;height:70px;left:68%;bottom:-90px;animation-duration:20s;animation-delay:1s;}
    .bg-bubbles li:nth-child(5){width:50px;height:50px;left:84%;bottom:-60px;animation-duration:24s;animation-delay:3s;}
    @keyframes float { from{transform:translateY(0) rotate(0);opacity:1} to{transform:translateY(-1100px) rotate(720deg);opacity:0} }
    @media (max-width:600px){ .bg-bubbles{display:none;} }

    .card{
      background:var(--glass-bg);
      border-radius:var(--radius);
      box-shadow:0 14px 40px rgba(2,6,23,0.28);
      overflow:hidden;
      border:1px solid rgba(0,0,0,0.04);
    }

    .card-header{
      background: linear-gradient(135deg,var(--bg1),var(--bg2));
      color:#fff;
      padding:28px 22px;
      text-align:center;
    }
    .logo{font-size:48px;line-height:1;margin-bottom:8px;display:inline-block;}
    .card-header h1{font-size:20px;margin:0 0 6px;font-weight:600;}
    .card-header p{margin:0;font-size:13px;opacity:0.95}

    .tabs{display:flex;background:#f7f9fb;border-bottom:1px solid #eef2f7}
    .tab-btn{
      flex:1;
      padding:14px;
      text-align:center;
      cursor:pointer;
      font-weight:600;
      color:var(--muted);
      border:none;background:transparent;
      font-size:14px;
    }
    .tab-btn[aria-selected="true"]{background: #fff;color:#243047;box-shadow: inset 0 -3px 0 rgba(102,126,234,0.08);}

    .card-body{padding:18px;display:grid;gap:12px}

    form{display:grid;gap:12px}
    label{display:block;font-size:13px;margin-bottom:6px;color:#404b57}
    .input-wrap{position:relative}
    .input-wrap i{position:absolute;left:12px;top:50%;transform:translateY(-50%);color:var(--muted);font-size:14px}

    /* Important: padding-left for left icon, padding-right to make space for eye button */
    .input-wrap input, .input-wrap select {
      width:100%;
      padding:12px 48px 12px 44px;
      border-radius:10px;
      border:2px solid #e9eef6;
      font-size:15px;
      outline:none;
      background:#fff;
    }
    .input-wrap input::placeholder{color:#a6b0bc}
    .input-wrap input:focus, .input-wrap select:focus { box-shadow:0 6px 18px rgba(102,126,234,0.12); outline:none; border-color: rgba(102,126,234,0.4); }

    /* show/hide password icon — FIXED placement */
    .toggle-pass{
      position:absolute;
      right:10px;
      top:50%;
      transform:translateY(-50%);
      background:transparent;
      border:none;
      color:var(--muted);
      padding:6px;
      border-radius:8px;
      cursor:pointer;
      display:flex;
      align-items:center;
      justify-content:center;
      height:32px;
      width:32px;
    }
    .toggle-pass:active{transform:translateY(-50%) scale(0.98)}
    .toggle-pass i{font-size:15px}

    .btn{
      display:inline-flex;align-items:center;justify-content:center;gap:10px;width:100%;padding:12px;border-radius:10px;border:none;
      background:linear-gradient(135deg,var(--bg1),var(--bg2));
      color:#fff;font-weight:700;font-size:15px;cursor:pointer;box-shadow:0 8px 18px rgba(102,126,234,0.18);
    }
    .btn[disabled]{opacity:0.6;cursor:not-allowed}

    .btn .loading { display:inline-block;width:18px;height:18px;border:3px solid rgba(255,255,255,.3);border-radius:50%;border-top-color:#fff;animation:spin 1s linear infinite; }
    @keyframes spin { to { transform: rotate(360deg); } }

    .message{padding:10px;border-radius:8px;font-size:14px;text-align:center}
    .success{background:#e6f6ea;color:#0b6b2f;border:1px solid rgba(11,107,47,0.08)}
    .error{background:#fff0f0;color:#941b1b;border:1px solid rgba(148,27,27,0.06)}

    .small {font-size:13px;color:#6b7682;text-align:center}

    @media (max-width:420px){
      :root{--max-width:390px}
      .card-header{padding:20px}
      .logo{font-size:40px}
      .card-body{padding:14px}
      .input-wrap input, .input-wrap select { padding:10px 44px 10px 40px; font-size:14px; }
      .tab-btn{padding:12px;font-size:13px}
      .toggle-pass{right:8px;height:30px;width:30px}
    }

    .tab-btn:focus, .btn:focus, .input-wrap input:focus, .input-wrap select:focus{box-shadow:0 6px 18px rgba(102,126,234,0.12);outline:none;border-color:rgba(102,126,234,0.5);}
  </style>
</head>
<body>
  <ul class="bg-bubbles" aria-hidden="true">
    <li></li><li></li><li></li><li></li><li></li>
  </ul>

  <main class="wrap" role="main">
    <section class="card" aria-labelledby="portalTitle">
      <div class="card-header">
        <span class="logo" aria-hidden="true"><i class="fas fa-wallet"></i></span>
        <h1 id="portalTitle">Student Payment Portal</h1>
        <p>Secure access to your payment dashboard</p>
      </div>

      <nav class="tabs" role="tablist" aria-label="Authentication tabs">
        <button class="tab-btn" role="tab" aria-selected="true" data-target="login" id="tab-login"> <i class="fas fa-sign-in-alt" aria-hidden="true"></i> Login</button>
        <button class="tab-btn" role="tab" aria-selected="false" data-target="register" id="tab-register"> <i class="fas fa-user-plus" aria-hidden="true"></i> Register</button>
      </nav>

      <div class="card-body">
        <!-- LOGIN -->
        <div id="login" role="tabpanel" aria-labelledby="tab-login">
          <form id="loginForm" autocomplete="on" novalidate>
            <div>
              <label for="loginEmail">Email address</label>
              <div class="input-wrap">
                <i class="fas fa-envelope" aria-hidden="true"></i>
                <input id="loginEmail" name="email" type="email" inputmode="email" placeholder="you@example.com" required autocomplete="email" />
              </div>
            </div>

            <div>
              <label for="loginPassword">Password</label>
              <div class="input-wrap" style="position:relative;">
                <i class="fas fa-lock" aria-hidden="true"></i>
                <input id="loginPassword" name="password" type="password" placeholder="Enter your password" required autocomplete="current-password" minlength="4" />
                <button type="button" class="toggle-pass" aria-label="Show password" id="toggleLoginPass"><i class="fas fa-eye"></i></button>
              </div>
            </div>

            <button class="btn" id="loginBtn" type="submit">
              <span class="btn-text"><i class="fas fa-paper-plane"></i> Sign in</span>
              <span class="btn-loading" style="display:none;margin-left:6px"><span class="loading" aria-hidden="true"></span></span>
            </button>
          </form>

          <div id="loginMessage" class="message" aria-live="polite" style="display:none"></div>
          <p class="small">Don't have an account? <button class="tab-btn" data-target="register" style="background:none;border:none;color:var(--bg1);padding:0;font-weight:700;cursor:pointer">Register</button></p>
        </div>

        <!-- REGISTER -->
        <div id="register" role="tabpanel" hidden>
          <form id="registerForm" autocomplete="on" novalidate>
            <div>
              <label for="regFullName">Full name</label>
              <div class="input-wrap">
                <i class="fas fa-user" aria-hidden="true"></i>
                <input id="regFullName" name="fullName" type="text" placeholder="Your name" required autocomplete="name" />
              </div>
            </div>

            <div>
              <label for="regEmail">Email address</label>
              <div class="input-wrap">
                <i class="fas fa-envelope" aria-hidden="true"></i>
                <input id="regEmail" name="email" type="email" inputmode="email" placeholder="you@example.com" required autocomplete="email" />
              </div>
            </div>

            <div>
              <label for="regPassword">Password</label>
              <div class="input-wrap" style="position:relative;">
                <i class="fas fa-lock" aria-hidden="true"></i>
                <input id="regPassword" name="password" type="password" placeholder="Minimum 4 characters" required minlength="4" autocomplete="new-password" />
                <button type="button" class="toggle-pass" aria-label="Show password" id="toggleRegPass"><i class="fas fa-eye"></i></button>
              </div>
            </div>

            <div>
              <label for="regMemberId">Member ID</label>
              <div class="input-wrap">
                <i class="fas fa-id-card" aria-hidden="true"></i>
                <input id="regMemberId" name="memberId" type="text" placeholder="e.g. safi" required />
              </div>
            </div>

            <div>
              <label for="regPhone">Phone number</label>
              <div class="input-wrap">
                <i class="fas fa-phone" aria-hidden="true"></i>
                <input id="regPhone" name="phone" inputmode="tel" pattern="[0-9+ ]{6,20}" placeholder="e.g. 017XXXXXXXX" required />
              </div>
            </div>

            <button class="btn" id="registerBtn" type="submit">
              <span class="btn-text"><i class="fas fa-user-plus"></i> Create account</span>
              <span class="btn-loading" style="display:none;margin-left:6px"><span class="loading" aria-hidden="true"></span></span>
            </button>
          </form>

          <div id="registerMessage" class="message" aria-live="polite" style="display:none"></div>
          <p class="small">Already have an account? <button class="tab-btn" data-target="login" style="background:none;border:none;color:var(--bg1);padding:0;font-weight:700;cursor:pointer">Login</button></p>
        </div>
      </div>
    </section>
  </main>

  <script>
    // === Updated Apps Script URL ===
    const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwzEhH_iXZyC3dbc-A40GlsgKnLyY4R3w2lwzY0YQmFf1J7MJ5Pzy_IlXFFQlcYz6Kj/exec';

    // Tab handling (keyboard friendly)
    document.querySelectorAll('.tab-btn').forEach(btn=>{
      btn.addEventListener('click', ()=> switchTab(btn.dataset.target));
      btn.addEventListener('keydown', (e)=>{ if(e.key==='Enter' || e.key===' '){ e.preventDefault(); switchTab(btn.dataset.target);} });
    });

    function switchTab(target){
      // tabs
      document.querySelectorAll('.tab-btn').forEach(b=>{
        b.setAttribute('aria-selected', b.dataset.target === target ? 'true':'false');
      });
      // panels
      ['login','register'].forEach(id=>{
        const panel = document.getElementById(id);
        const selected = id === target;
        panel.hidden = !selected;
        panel.setAttribute('aria-hidden', (!selected).toString());
      });
      // focus first input
      setTimeout(()=>{
        const first = document.querySelector(`#${target} input`);
        if(first) first.focus();
      }, 50);
    }

    // Password toggles (keeps icons inside box)
    function togglePassword(btnId, inputId){
      const btn = document.getElementById(btnId);
      const input = btn && document.getElementById(inputId);
      if(!btn || !input) return;
      btn.addEventListener('click', ()=>{
        const isPwd = input.type === 'password';
        input.type = isPwd ? 'text' : 'password';
        btn.innerHTML = isPwd ? '<i class="fas fa-eye-slash"></i>' : '<i class="fas fa-eye"></i>';
        btn.setAttribute('aria-pressed', String(isPwd));
      });
    }
    togglePassword('toggleLoginPass','loginPassword');
    togglePassword('toggleRegPass','regPassword');

    // Redirect if already logged in
    window.addEventListener('load', ()=>{
      try{
        const u = localStorage.getItem('currentUser');
        if(u) location.href = 'dashboard.html';
      }catch(e){}
      // ensure initial tab
      switchTab('login');
    });

    // helper to show messages
    function showMessage(elem, text, kind='success'){
      elem.style.display = 'block';
      elem.className = 'message ' + (kind === 'error' ? 'error' : 'success');
      elem.textContent = text;
      elem.focus?.();
    }
    function hideMessage(elem){
      elem.style.display = 'none';
      elem.textContent = '';
    }

    // LOGIN submit
    document.getElementById('loginForm').addEventListener('submit', async (e)=>{
      e.preventDefault();
      hideMessage(document.getElementById('loginMessage'));
      const btn = document.getElementById('loginBtn');
      btn.querySelector('.btn-text').style.display='none';
      btn.querySelector('.btn-loading').style.display='inline-block';
      btn.disabled = true;

      const form = e.target;
      const data = new URLSearchParams();
      data.append('action','login');
      data.append('email', form.email.value.trim());
      data.append('password', form.password.value);

      try{
        const res = await fetch(SCRIPT_URL,{method:'POST',body:data});
        const j = await res.json();
        if(j.result === 'success'){
          localStorage.setItem('currentUser', JSON.stringify(j.user));
          showMessage(document.getElementById('loginMessage'),'Login successful — redirecting...', 'success');
          setTimeout(()=> location.href = 'dashboard.html', 800);
        } else {
          showMessage(document.getElementById('loginMessage'), j.message || 'Invalid credentials', 'error');
        }
      }catch(err){
        showMessage(document.getElementById('loginMessage'),'Network error — try again','error');
      } finally {
        btn.querySelector('.btn-text').style.display='inline-flex';
        btn.querySelector('.btn-loading').style.display='none';
        btn.disabled = false;
      }
    });

    // REGISTER submit
    document.getElementById('registerForm').addEventListener('submit', async (e)=>{
      e.preventDefault();
      hideMessage(document.getElementById('registerMessage'));
      const btn = document.getElementById('registerBtn');
      btn.querySelector('.btn-text').style.display='none';
      btn.querySelector('.btn-loading').style.display='inline-block';
      btn.disabled = true;

      const form = e.target;
      const data = new URLSearchParams();
      data.append('action','register');
      data.append('email', form.email.value.trim());
      data.append('password', form.password.value);
      data.append('memberId', form.memberId.value.trim());
      data.append('fullName', form.fullName.value.trim());
      data.append('phone', form.phone.value.trim());

      try{
        const res = await fetch(SCRIPT_URL,{method:'POST',body:data});
        const j = await res.json();
        if(j.result === 'success'){
          showMessage(document.getElementById('registerMessage'), 'Registration successful — please sign in.', 'success');
          // switch to login tab and reset
          document.getElementById('registerForm').reset();
          switchTab('login');
        } else {
          showMessage(document.getElementById('registerMessage'), j.message || 'Registration error', 'error');
        }
      }catch(err){
        showMessage(document.getElementById('registerMessage'),'Network error — try again','error');
      } finally {
        btn.querySelector('.btn-text').style.display='inline-flex';
        btn.querySelector('.btn-loading').style.display='none';
        btn.disabled = false;
      }
    });

  </script>
</body>
</html>
