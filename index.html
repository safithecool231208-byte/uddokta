<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Uddokta — Login / Register</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
<style>
:root{
  --bg1:#3b82f6; /* blue */
  --bg2:#7c3aed; /* purple */
  --card: rgba(255,255,255,0.92);
  --muted:#64748b;
  --accent-gradient: linear-gradient(90deg,#3b82f6,#7c3aed);
  --radius:14px;
  --shadow: 0 10px 30px rgba(2,6,23,0.12);
}
*{box-sizing:border-box;font-family:'Poppins',system-ui,Segoe UI,Roboto,Arial}
html,body{height:100%;margin:0;background:linear-gradient(135deg,var(--bg1),var(--bg2));-webkit-font-smoothing:antialiased}
.container{max-width:1100px;margin:28px auto;padding:20px}
.header{display:flex;justify-content:space-between;align-items:center;color:#fff;margin-bottom:18px}
.brand{font-weight:700;font-size:20px}
.card{background:var(--card);border-radius:var(--radius);padding:22px;box-shadow:var(--shadow);backdrop-filter:blur(6px)}
.auth-grid{display:grid;grid-template-columns:1fr 1fr;gap:18px}
@media(max-width:860px){ .auth-grid{grid-template-columns:1fr} .header{flex-direction:column;align-items:flex-start} }
h2{margin:0 0 8px 0}
.small{color:var(--muted);font-size:13px}
label{display:block;margin:8px 0 6px;font-size:13px;color:#334155}
.input, select { width:100%; padding:10px 12px; border-radius:10px; border:1px solid #e6eef9; font-size:15px; outline:none }
.input:focus{box-shadow:0 6px 18px rgba(59,130,246,0.12); border-color:#7c3aed}
.row{display:flex;gap:10px;align-items:center}
.btn{background:var(--accent-gradient);color:white;padding:10px 14px;border-radius:10px;border:none;cursor:pointer;font-weight:600;transition:transform .12s ease,opacity .12s}
.btn.secondary{background:white;color:var(--bg2);border:1px solid rgba(0,0,0,0.06)}
.btn:hover{transform:translateY(-3px)}
.note{font-size:13px;color:var(--muted);margin-top:8px}
.msg{padding:10px;border-radius:10px;margin-top:10px;display:none}
.msg.success{background:linear-gradient(90deg,#16a34a,#059669);color:white}
.msg.error{background:linear-gradient(90deg,#ef4444,#dc2626);color:white}

/* small helper */
.center { display:flex; justify-content:center; align-items:center; gap:10px }
.link { color:var(--bg2); cursor:pointer; text-decoration:underline; font-weight:600; }
</style>
</head>
<body>
  <div class="container">
    <div class="header">
      <div>
        <div class="brand">Uddokta — Member Portal</div>
        <div class="small">Secure login and registration — Payments portal</div>
      </div>
      <div class="center">
        <button id="openDashboardBtn" class="btn secondary" title="Open Dashboard (if logged)">Open Dashboard</button>
        <button id="adminBtnTop" class="btn">Admin</button>
      </div>
    </div>

    <div class="card">
      <div class="auth-grid">
        <!-- LOGIN -->
        <div>
          <h2>Member Login</h2>
          <div id="loginMsg" class="msg error"></div>

          <label for="loginEmail">Email</label>
          <input id="loginEmail" class="input" type="email" placeholder="you@example.com" autocomplete="username">

          <label for="loginPass">Password</label>
          <input id="loginPass" class="input" type="password" placeholder="Your password" autocomplete="current-password">

          <div class="row" style="margin-top:12px">
            <button id="btnLogin" class="btn">Login</button>
            <button id="btnToRegister" class="btn secondary">Go to Register</button>
          </div>

          <div class="note">Login with the email and password you registered with. Forgotten password recovery is not implemented.</div>
        </div>

        <!-- REGISTER -->
        <div>
          <h2>Register New Member</h2>
          <div id="regMsg" class="msg"></div>

          <label for="regName">Full Name</label>
          <input id="regName" class="input" placeholder="Hami Abrar Safi">

          <label for="regEmail">Email</label>
          <input id="regEmail" class="input" type="email" placeholder="you@example.com" autocomplete="email">

          <label for="regPass">Password</label>
          <input id="regPass" class="input" type="password" placeholder="Choose a password" autocomplete="new-password">

          <label for="regNumber">Phone Number</label>
          <input id="regNumber" class="input" placeholder="017xxxxxxxx">

          <label for="regAddress">Address</label>
          <input id="regAddress" class="input" placeholder="City / Area">

          <div class="row" style="margin-top:10px">
            <button id="btnRegister" class="btn">Register</button>
            <button id="btnToLogin" class="btn secondary">Back to Login</button>
          </div>

          <div class="note">We store your details in the Members sheet. Use email+password to log in afterwards.</div>
        </div>
      </div>
    </div>

    <div style="text-align:center;margin-top:12px">
      <small style="color:#f8fafc">Tip: Admin panel available via Admin button (password protected).</small>
    </div>
  </div>

<script>
/* ====== CONFIG ====== */
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbypMtu8q9NayvGiRNWazRAkG0bnuHeC5EMf19IpYfT4HoVmy9ffOc8sTJuHEVpamqvN/exec";
const ADMIN_PASSWORD = "admin";

/* ====== HELPERS ====== */
function el(id){ return document.getElementById(id); }
function showMsg(el, text, type='error'){ el.textContent = text; el.className = 'msg ' + (type==='success' ? 'success' : 'error'); el.style.display = 'block'; setTimeout(()=>{ el.style.display='none'; }, 4500); }
function saveUser(user){ localStorage.setItem('portalUser', JSON.stringify(user)); }
function getUser(){ try{ return JSON.parse(localStorage.getItem('portalUser')||'null'); }catch(e){return null;} }
function goDashboard(){ window.location.href = 'dashboard.html'; }

/* ====== UI wiring ====== */
el('btnToRegister').addEventListener('click', ()=> { window.scrollTo({top:0,behavior:'smooth'}); el('regName').focus(); });
el('btnToLogin').addEventListener('click', ()=> { window.scrollTo({top:0,behavior:'smooth'}); el('loginEmail').focus(); });
el('openDashboardBtn').addEventListener('click', ()=> { const u=getUser(); if(u) goDashboard(); else showMsg(el('loginMsg'), 'You must login first to open dashboard.'); });
el('adminBtnTop').addEventListener('click', ()=> { const p = prompt('Enter admin password:'); if(p===ADMIN_PASSWORD){ window.location.href='admin.html'; } else if(p!==null) alert('Incorrect admin password'); });

/* ====== REGISTER ====== */
el('btnRegister').addEventListener('click', async ()=>{
  const name = el('regName').value.trim();
  const email = el('regEmail').value.trim();
  const password = el('regPass').value;
  const number = el('regNumber').value.trim();
  const address = el('regAddress').value.trim();

  if(!name || !email || !password){ showMsg(el('regMsg'), 'Please fill name, email and password', 'error'); return; }
  if(password.length < 4){ showMsg(el('regMsg'), 'Password must be at least 4 characters', 'error'); return; }

  const fd = new FormData();
  fd.append('action','register');
  fd.append('name', name);
  fd.append('email', email);
  fd.append('password', password);
  fd.append('number', number);
  fd.append('address', address);

  try{
    const res = await fetch(SCRIPT_URL, { method:'POST', body: fd });
    const json = await res.json();
    if(json.result === 'success'){
      showMsg(el('regMsg'), json.message || 'Registered successfully', 'success');
      // auto-fill login form with registered email
      el('loginEmail').value = email;
      el('loginPass').value = password;
      // optionally auto-login:
      saveUser({ email: email, name: name });
      setTimeout(()=>{ goDashboard(); }, 900);
    } else {
      showMsg(el('regMsg'), json.message || 'Registration failed', 'error');
    }
  }catch(err){
    console.error('register error', err);
    showMsg(el('regMsg'), 'Network error while registering', 'error');
  }
});

/* ====== LOGIN ====== */
el('btnLogin').addEventListener('click', async ()=>{
  const email = el('loginEmail').value.trim();
  const password = el('loginPass').value;

  if(!email || !password){ showMsg(el('loginMsg'), 'Enter email and password', 'error'); return; }

  const fd = new FormData();
  fd.append('action','login');
  fd.append('email', email);
  fd.append('password', password);

  try{
    const res = await fetch(SCRIPT_URL, { method:'POST', body: fd });
    const json = await res.json();
    if(json.result === 'success'){
      // json should include name (full name)
      const user = { email: email, name: json.name || email };
      saveUser(user);
      showMsg(el('loginMsg'), json.message || 'Login successful', 'success');
      setTimeout(()=> goDashboard(), 700);
    } else {
      showMsg(el('loginMsg'), json.message || 'Login failed', 'error');
    }
  }catch(err){
    console.error('login error', err);
    showMsg(el('loginMsg'), 'Network error while logging in', 'error');
  }
});

/* ====== AUTO-REDIRECT IF ALREADY LOGGED IN ====== */
(function(){
  const u = getUser();
  if(u){ /* If already logged in, send to dashboard immediately */ setTimeout(()=>{ goDashboard(); }, 300); }
})();
</script>
</body>
</html>
